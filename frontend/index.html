<script>
    // Detect the current frontend host (EC2 public IP or domain)
    const host = window.location.hostname;

    // Backend runs on 30808, frontend on 30080
    const backendBaseUrl = `http://${host}:30808`;

    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const saveBtn = document.getElementById('saveBtn');
    const responseParagraph = document.getElementById('response');
    const userListDiv = document.getElementById('userList');

    // Load all users
    async function loadUsers() {
        try {
            const response = await fetch(`${backendBaseUrl}/users`);
            const users = await response.json();
            userListDiv.innerHTML = users.map(u => `${u.id} | ${u.name} | ${u.email}`).join('<br>');
        } catch (err) {
            userListDiv.innerText = 'Error loading users: ' + err;
        }
    }

    // Run once on load
    loadUsers();

    // Save user
    saveBtn.addEventListener('click', async () => {
        const user = {
            name: nameInput.value,
            email: emailInput.value
        };

        try {
            const response = await fetch(`${backendBaseUrl}/users`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(user)
            });
            const savedUser = await response.json();
            responseParagraph.innerText = `Saved user with ID: ${savedUser.id ?? "(no id in response)"}`;
            nameInput.value = '';
            emailInput.value = '';
            loadUsers();
        } catch (err) {
            responseParagraph.innerText = 'Error: ' + err;
        }
    });
</script>
